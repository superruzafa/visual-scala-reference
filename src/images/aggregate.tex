\input{_header.tex}

\matrix (A) [collection, name prefix=a] {
    \node (1) {$a_1$};       &
    \node (2) {$a_2$};       &
    \node (e1) [ellipsis];   &
    \node (i) {$a_i$};       &
    \node (i+1) {$a_{i+1}$}; &
    \node (e2) [ellipsis];   &
    \node (n-1) {$a_{n-1}$}; &
    \node (n) {$a_n$};       \\
};

\node (z) [elem, left=5mm of a1] {z};

\node (f1) [below=15mm of a1.west]   {$\texttt{seqop}(\textrm{z}, a_1)$};
\node (f2) [below=25mm of a2.west]   {$\texttt{seqop}(z_1, a_2)$};
\node (f3) [below=15mm of ai+1.west] {$\texttt{seqop}(a_i, a_{i+1})$};
\node (f4) [below=15mm of an.west]   {$\texttt{seqop}(a_{n-1}, a_n)$};

\node (f5) [below=30mm of ae1] {$\texttt{combop}(z_j, z_k)$};
\node (f6) [below=50mm of ai+1.west] {$\texttt{combop}(z_l, z_m)$};

\node (B) [elem, below=10mm of f6] {$b$};

\begin{scope}
  \tikzstyle{every path}=[arrow]
  \draw [white border, out=270, in=90] (z.south) to (f1.70);
  \draw [white border, out=270, in=90] (a1.south) to (f1.30);

  \draw [white border, out=270, in=90] (ai.south) to (f3.70);
  \draw [white border, out=270, in=90] (ai+1.south) to (f3.25);

  \draw [white border, out=0, in=90] (f1.east) to (f2.60);
  \draw [white border, out=270, in=90] (a2.south) to (f2.25);

  \draw [white border, out=0, in=90, middotted] (f2.east) to (f5.45);
  \draw [white border, out=180, in=90, middotted] (f3.west) to (f5.22);

  \draw [white border, out=270, in=90] (an-1.south) to (f4.70);
  \draw [white border, out=270, in=90] (an.south) to (f4.20);

  \draw [white border, out=180, in=90, middotted] (f4.west) to (f6.20);
  \draw [white border, out=0, in=90, middotted] (f5.east) to (f6.45);

  \draw (f6) [elem] -- (B);
\end{scope}

\input{_footer.tex}
