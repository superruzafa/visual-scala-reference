---
---

\matrix (A) [collection] {
    \node [elements before]; &
    \node (aj-1) {$a_{j - 1}$}; &
    \node (aj) {$a_j$}; &
    \node (aj+1) {$a_{j + 1}$}; &
    \node [elements between]; &
    \node (aj+m-1) {$a_{j + m - 1}$}; &
    \node (aj+m) {$a_{j + m}$}; &
    \node [elements after]; &
\\ };

\measure{\texttt{m}}{aj.north west}{aj+m-1.north east}

\matrix (B) [collection, right=1 of A] {
    \node (b1) {$b_1$}; &
    \node [elements between]; &
    \node (bn) {$b_n$}; &
\\ };

\matrix (C) [collection, below=3 of A] {
    \node [elements before]; &
    \node (cj-1) {$a_{j - 1}$}; &
    \node (c1) {$b_1$}; &
    \node [elements between]; &
    \node (cn) {$b_n$}; &
    \node (cj+m) {$a_{j + m}$}; &
    \node [elements after]; &
\\ };

\braceflow[-.2]{(A.south west)}{(aj-1.south east)}
\coordinate (x) at (lastbrace);
\braceflow[.2]{(C.north west)}{(cj-1.north east)}
\draw [flow ->, out=270, in=90] (x) to (lastbrace);

\braceflow[-.2]{(aj+m.south west)}{(A.south east)}
\coordinate (x) at (lastbrace);
\braceflow[.2]{(cj+m.north west)}{(C.north east)}
\draw [flow ->, out=270, in=90] (x) to (lastbrace);

\braceflow[-.2]{(b1.south west)}{(bn.south east)}
\coordinate (x) at (lastbrace);
\braceflow[.2]{($ (c1.north west) + (.5\defaultpenwidth, 0) $)}{($ (cn.north east) + (-.5\defaultpenwidth, 0) $)}
\draw [flow ->, out=270, in=90] (x) to (lastbrace);
